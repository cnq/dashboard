(function(){(function(){"use strict";return angular.module("app.directory.ctrls",[]).controller("DirectoryCtrl",["$rootScope","$scope","$q","$filter","logger","$location","directoryService",function(n,t,i,r,u,f,e){return t.list=[],t.directoryItemParent=[],e.getItems().then(function(n){return t.list=n,t.populateFirstChildren(n).then(function(){return t.buildChildMap()})}),t.populateFirstChildren=function(n){var t;return t=void 0,t=[],angular.forEach(n,function(n){var i;return i=void 0,i=e.getItem(n.id).then(function(t){return n.children=t.children}),t.push(i)}),i.all(t)},t.buildChildMap=function(){var n;return n=void 0,t.directoryItemParent.length=0,n=t.list,angular.forEach(n,function(n){return t.mapChildren(n)})},t.mapChildren=function(n){return angular.forEach(n.children,function(i){return t.directoryItemParent.push({parent:n,child:i}),t.mapChildren(i)})},t.getParent=function(n){var i;return i=void 0,i=r("filter")(t.directoryItemParent,{child:n},!0),i.length?i[0].parent:null},t.itemPath=function(n){var i,r;for(i=void 0,r=void 0,i=n,r="";i;)r="/"+i.name+r,i=t.getParent(i);return r},t.selectedItem={},t.onRightClick=function(n,i){return t.selectedItem=n,t.selectedItemInlineForm=i},t.remove=function(){return $("#cm").removeClass("open"),e.deleteItem(t.selectedItem.$modelValue),t.selectedItem.remove()},t.renameClick=function(){return t.selectedItemInlineForm.$show()},t.compress=function(){return e.compressItem(t.selectedItem.$modelValue).then()(function(){var n;return n=void 0,n=t.getParent(t.selectedItem),t.refreshFolder(n)})},t.saveRename=function(n,i){if(i.name!==n)return i.name=n,i.path=t.itemPath(i),e.getItem(i.id).then(function(n){return n.name=i.name,n.path=i.path,e.saveItem(n).then(function(n){return i.id=n.id,i.children=n.children,t.buildChildMap()})})},t.onFolderClick=function(n){return n.collapsed?(t.expandFolder(n),t.refreshFolder(n)):t.collapseFolder(n)},t.onFileClick=function(n){return n.$modelValue.path.endsWith(".html")||n.$modelValue.path.endsWith(".css")||n.$modelValue.path.endsWith(".js")||n.$modelValue.path.endsWith(".json")||n.$modelValue.path.endsWith(".txt")?f.path("/contents/"+n.$modelValue.id+"/edit"):f.path("/contents/"+n.$modelValue.id+"/view")},t.onFileSelectClick=function(n){return f.path("/contents/"+n.$modelValue.id+"/select")},t.expandFolder=function(n){if(n.collapsed)return n.toggle()},t.collapseFolder=function(n){if(!n.collapsed)return n.toggle(),$("#file-scroll").slimscroll()},t.refresh=function(){return t.refreshFolder(t.selectedItem),t.expandFolder(t.selectedItem)},t.refreshFolder=function(n){return e.getItem(n.$modelValue.id).then(function(i){return n.$modelValue.children=i.children,t.buildChildMap()}),t.populateFirstChildren(n.$modelValue.children).then(function(){return t.buildChildMap()}),$("#file-scroll").slimscroll()},t.newFiles=function(){return n.currentFolder=t.selectedItem.$modelValue.path,f.path("/contents/newfiles")},t.newSubFolder=function(){var n;return n=void 0,n=e.newItem(),n.type="Directory",n.name="untitled",t.selectedItem.$modelValue.children.push(n),t.buildChildMap(),n.path=t.itemPath(n),e.saveItem(n).then(function(){return t.refreshFolder(t.selectedItem),t.expandFolder(t.selectedItem)})}}])}).call(this)}).call(this);
//# sourceMappingURL=DirectoryCtrl.min.js.map
