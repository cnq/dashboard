(function(){(function(){"use strict";return angular.module("app.content.ctrls",[]).controller("ContentListCtrl",["$scope","logger","$filter","contentsService",function(n,t,i,r){var u;return u=void 0,u=function(){return n.search(),n.select(n.currentPage)},r.getContents().then(function(t){return n.contents=t,n.searchKeywords="",n.filteredItems=[],n.row="",n.select=function(t){var r,i;return r=void 0,i=void 0,i=(t-1)*n.numPerPage,r=i+n.numPerPage,n.currentPageItems=n.filteredItems.slice(i,r)},n.onFilterChange=function(){return n.select(1),n.currentPage=1,n.row=""},n.onNumPerPageChange=function(){return n.select(1),n.currentPage=1},n.onOrderChange=function(){return n.select(1),n.currentPage=1},n.search=function(){return n.filteredItems=i("filter")(n.contents,n.searchKeywords),n.onFilterChange()},n.order=function(t){if(n.row!==t)return n.row=t,n.filteredItems=i("orderBy")(n.contents,t),n.onOrderChange()},n.numPerPageOpt=[3,5,10,20],n.numPerPage=n.numPerPageOpt[2],n.currentPage=1,n.currentPageItems=[],n.deleteContent=function(t){return r.deleteContent(t).then(function(){return n.contents=_.without(n.contents,t),u()})},u()})}]).controller("ContentViewCtrl",["$scope","logger","$routeParams","$location","directoryService",function(n,t,i,r,u){return u.getItem(i.Id).then(function(t){return n.content=t}),n.download=function(){return window.open(downloadPath,"_blank","")}}]).controller("ContentSelectCtrl",["$scope","logger","$routeParams","$location","directoryService",function(n,t,i,r,u){return u.getItem(i.Id).then(function(t){return n.content=t}),n.download=function(){return window.open(downloadPath,"_blank","")},n.onSelectClick=function(n){return parent.$.colorbox.selectedData={id:n.id,path:n.path},parent.$.colorbox.close()}}]).controller("ContentEditCtrl",["$scope","logger","$routeParams","$location","contentsService",function(n,t,i,r,u){return u.getContent(i.Id).then(function(t){n.content=t;n.original=angular.copy(n.content);n.editorSession.setValue(n.content.body);n.content.contentType.indexOf("javascript")>=0?n.editorSession.setMode("ace/mode/javascript"):n.content.contentType.indexOf("css")>=0?n.editorSession.setMode("ace/mode/css"):n.editorSession.setMode("ace/mode/html");n.editorSession.on("change",function(){return n.content.body=n.editorSession.getValue(),n.$apply()});return n.canSubmit=function(){return n.content.path&&!angular.equals(n.content,n.original)}}),n.submitForm=function(){return n.showInfoOnSubmit=!0,u.saveContent(n.content).then(function(){return r.path("/contents")})},n.cancel=function(){return r.path("/contents")},n.aceLoaded=function(t){var r,i;return r=void 0,i=void 0,i=t.getSession(),n.editorSession=i,r=t.renderer,t.setHighlightActiveLine(!1),t.setShowPrintMargin(!1),t.setOptions({enableBasicAutocompletion:!0}),t.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor|cli"},exec:function(){return n.showInfoOnSubmit=!0,u.saveContent(n.content),n.original=angular.copy(n.content),n.$apply()}})}}]).controller("ContentNewFilesCtrl",["$rootScope","$scope","logger","$routeParams","$location",function(n,t,i,r,u){return t.newCodeFile=function(){return u.path("/contents/new")},t.uploadFiles=function(){return u.path("/contents/upload")}}]).controller("ContentCmsHomeCtrl",["$rootScope","$scope","logger","$routeParams","$location",function(n,t,i,r,u){return t["new"]=function(){return u.path("/cms/new")},t.audit=function(){return u.path("/cms/audit")},t.list=function(){return u.path("/cms/items")},t.types=function(){return u.path("/cms/types")},t.workflows=function(){return u.path("/cms/workflows")},t.queries=function(){return u.path("/cms/projections")},t.newLayout=function(){return u.path("/contents/newlayout")}}]).controller("ContentNewCtrl",["$rootScope","$scope","logger","$routeParams","$location","contentsService",function(n,t,i,r,u,f){return t.content=f.newContent(),n.currentFolder&&(t.content.path=n.currentFolder+"/untitled.html"),t.original=angular.copy(t.content),t.canSubmit=function(){return t.content.path&&!angular.equals(t.content,t.original)},t.submitForm=function(){return t.showInfoOnSubmit=!0,f.saveContent(t.content).then(function(){return u.path("/contents")})},t.cancel=function(){return u.path("/contents")},t.aceLoaded=function(n){var r,i;r=void 0;i=void 0;i=n.getSession();t.editorSession=i;r=n.renderer;n.setHighlightActiveLine(!1);n.setShowPrintMargin(!1);n.setOptions({enableBasicAutocompletion:!0});t.editorSession.setMode("ace/mode/html");t.editorSession.on("change",function(){return t.content.body=t.editorSession.getValue(),t.$apply()});return n.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor|cli"},exec:function(){return t.showInfoOnSubmit=!0,f.saveContent(t.content),t.original=angular.copy(t.content),t.$apply()}})}}]).controller("ContentUploadCtrl",["$rootScope","$scope","logger","$routeParams","$location","$upload",function(n,t,i,r,u,f){return t.uploadprogress=0,t.onFileSelect=function(r){var o,u,s,e;for(o=void 0,u=void 0,s=void 0,e=void 0,e=[],u=0,s=r.length;u<s;)o=r[u],e.push(t.upload=f.upload({url:"/api/files",method:"POST",data:{basepath:n.currentFolder},file:o}).progress(function(n){return t.uploadprogress=parseInt(100*n.loaded/n.total),console.log("percent: "+parseInt(100*n.loaded/n.total))}).success(function(){return i.logSuccess("File Uploaded")})),u++;return e},t.cancel=function(){return u.path("/files")}}])}).call(this)}).call(this);
//# sourceMappingURL=ContentCtrl.min.js.map
